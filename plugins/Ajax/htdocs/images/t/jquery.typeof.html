<html>
<head>
	<title>JavaScript Unit Tests: $.TypeOf</title>

	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.js"></script>
	<script type="text/javascript" src="http://dev.jquery.com/view/trunk/qunit/testrunner.js"></script>
	<link   type="text/css"       href="http://dev.jquery.com/view/trunk/qunit/testsuite.css" rel="stylesheet" media="screen">

	<script type="text/javascript" src="../jquery.typeof.js"></script>


<script type="text/javascript">
// contain our namespace
(function($){

// run when document.ready
$(function(){

//module('$.TypeOf');

var specificity = {
	'object':0,

	'boolean':2,
	'number':2,
	'string':2,
	'function':2,

	'string.char':3,
	'string.empty':3,

	'list':1,
	'list.empty':2,
	'object.empty':3,

	'array':2,
	'array.empty':3,

	'jquery':3,
	'jquery.empty':4,

	'node':3,
	'element':4,

	'date':4,
	'regexp':4,

	'node.element':5,
	'node.attribute':5,
	'node.text':5,

	'null':10,
	'undefined':10,
	'document':10,
	'node.document':11,
	'window':10,
	'number.NaN':10,
	'number.Infinity':10
};

var	T = $.TypeOf,
	typeOfUndefined	= T.makeTest(function(o)o===undefined),
	typeOfNull	= T.makeTest(function(o)o===null),
	typeOfInfinity	= T.makeTest(function(o)o===Infinity),
	typeOfNaN	= T.makeTest(function(o)o===NaN),
	typeOfEmpty	= T.makeTest(function(o, tn)/\.empty$/.test(tn));

function x(v){ v||(v=''); return '"'+v+'"'; }

function invariants( o, msg ){
	var tn = T(o), ptn = T.unadorned(o), jstn = typeof(o);

	var label = typeof(o)==='number' && isNaN(o) && 'NaN'
		|| o===undefined && 'undefined'
		|| o===null && 'null'
		|| msg
		|| o.toString()
		|| Object.prototype.toString.call(o)
		|| '*';

	var header = label+': typeof=>'+typeof(o)+', T=>'+tn+', T.unadorned=>'+ptn;
	if ( msg ) {
		header = 'given '+msg+', '+header;
	}


	ok(true, header);
	ok(specificity[tn]>=specificity[ptn], '...| T:'+x(tn)+' >= T.unadorned:'+x(jstn));
	ok(specificity[ptn]>=specificity[jstn], '...| T.unadorned'+x(ptn)+' >= typeof:'+x(jstn));


	ok(!!o == (T.yes(o)===tn), '...| '+label+'.yes <=> '+x(T.yes(o)));
	ok(!o == (T.no(o)===tn), '...| '+label+'.no <=> '+x(T.no(o)));
	ok((!o && o!==undefined) == (T.defNo(o)===tn), '...| '+label+'.defNo <=> '+x(T.defNo(o)));
	ok((o!==undefined) == (T.def(o)===tn), '...| '+label+'.def <=> '+x(T.def(o)));
	ok((o===undefined) == (T.undef(o)===tn), '...| '+label+'.undef <=> '+x(T.undef(o)));

	ok((o===undefined) == (tn==='undefined'), '...| '+label+'===undefined <=> '+x(typeOfUndefined(o)));
	ok((o===null) == (tn==='null'), '...| '+label+'===null <=> '+x(typeOfNull(o)));
	ok((o==Infinity) == (tn==='number.Infinity'), '...| '+label+'===Infinity <=> '+x(typeOfInfinity(o)));

	ok((isNaN(o) && (jstn==='number' || jstn==='object' && ptn==='number')) == (tn==='number.NaN'), '...| '+label+'===NaN <=> '+x(typeOfNaN(o)));
	//ok((o && (o!==NaN) && o.length!==undefined && !o.length) == /\.empty$/.test(tn), '...| '+label+' is empty <=> '+x(typeOfEmpty(o)));
}

function variations( o, msg ){
	invariants(o, msg);

	switch ( T.unadorned(o) ) {
		case 'string':
			invariants(Object(o), 'Object('+msg+')');
			invariants(String(o), 'String('+msg+')');
			break;
		case 'number':
			invariants(Object(o), 'Object('+msg+')');
			invariants(Number(o), 'Number('+msg+')');
			break;
		case 'boolean':
			invariants(Object(o), 'Object('+msg+')');
			invariants(Boolean(o), 'Boolean('+msg+')');
			break;
		case 'regexp':
			invariants(Object(o), 'Object('+msg+')');
			invariants(RegExp(o), 'RegExp('+msg+')');
			break;
		case 'array':
		case 'list':
			invariants(Object(o), 'Object('+msg+')');
			if ( o.length!==1 || typeof(o[0])!=='number' ) {
				invariants(Array.apply(null, Array.slice(o, 0)), 'Array from '+msg);
			}
			break;
	}
}

module('definition');

test('available', function(){
	ok('TypeOf' in $ && typeof($.TypeOf)==='function', '$.TypeOf exists, is a function');
	$.each('unadorned implementation scalar nonScalar list node fn undef def yes no defNo nonEmpty inherited inheritedFn makeTest'.split(/\s+/), function(){
		ok(this in $.TypeOf && typeof($.TypeOf[this])==='function', this+' exists, is a function');
	});
});

module('well-known objects');

test('well-known objects', function(){
	equals(T(document), 'node.document',	'document');
	invariants(document, 'document');

	equals(T(window), 'window',		'window');
	invariants(window, 'window');
});

module('scalars');

function scalar_tests( o, answer, label ){
	label || (label = o ? o.toString() : answer);

	ok(true, label+': scalar tests');
	ok(T.scalar(o)===answer, '...| '+label+'.scalar <=> '+x(T.scalar(o)));

	ok(!T.list(o), '...| '+label+'.list <=> '+x(T.list(o)));
	ok(!T.node(o), '...| '+label+'.node <=> '+x(T.node(o)));
	ok(!T.fn(o), '...| '+label+'.fn <=> '+x(T.fn(o)));
	ok(!T.nonScalar(o), '...| '+label+'.nonScalar <=> '+x(T.nonScalar(o)));
	ok(!T.nonEmpty(o), '...| '+label+'.nonEmpty <=> '+x(T.nonEmpty(o)));

	variations(o, label);
}

test('boolean', function(){
	scalar_tests(false, 'boolean', 'false');
	scalar_tests(true, 'boolean', 'true');
});

test('number', function(){
	scalar_tests(0, 'number', '0');
	scalar_tests(7, 'number', '7');
	scalar_tests(4.5, 'number', '4.5');
	scalar_tests(1/0, 'number.Infinity', '1/0');
	scalar_tests(0/0, 'number.NaN', '0/0');
});

test('string', function(){
	scalar_tests("", 'string.empty', '""');
	scalar_tests("x", 'string.char', '"x"');
	scalar_tests("Hello, World!", 'string', '"Hello, World!"');
});

test('null', function(){
	scalar_tests(null, 'null', 'null');
});

test('undefined', function(){
	scalar_tests(undefined, 'undefined', 'undefined');
});

module('lists');

function lists_tests( o, answer, label ){
	ok(true, label+': list tests');
	ok(T.list(o), '...| '+label+'.list <=> '+x(T.list(o)));
	ok(T.nonScalar(o)===answer, '...| '+label+'.nonScalar <=> '+x(T.nonScalar(o)));

	ok(!T.scalar(o), '...| '+label+'.scalar <=> '+x(T.scalar(o)));
	ok(!T.node(o), '...| '+label+'.node <=> '+x(T.node(o)));
	ok(!T.fn(o), '...| '+label+'.fn <=> '+x(T.fn(o)));

	ok(!!o.length==(T.nonEmpty(o)===answer), '...| '+label+'.nonEmpty <=> '+x(T.nonEmpty(o)));

	invariants(o, label);
};

test('array literals', function(){
	lists_tests([], 'array.empty', '[]');
	lists_tests(["hello", 5], 'array', '["hello", 5]');
});

test('jQuery selections', function(){
	lists_tests($([]), 'jquery.empty', '$([])');
	lists_tests($("*"), 'jquery', '$("*")');
});

test('the arguments object', function(){
	equals(T(arguments), 'list.empty', 'arguments, when empty');
	lists_tests(arguments, 'list.empty', 'arguments');
	(function(){
		equals(T(arguments), 'list', 'arguments, when non-empty');
		lists_tests(arguments, 'list', 'arguments');
	})("Hello, World!");
});

test('array objects', function(){
	var tn = T([]);
	equals(T(Object([])), tn, 'Object from empty array literal: Object([])');
	lists_tests(Object([]), tn, 'Object([])');
	equals(T(Array()), tn, 'empty Array: Array()');
	lists_tests(Array(), tn, 'Array()');

	tn = T(["hello", 5]);
	equals(T(Object(["hello", 5])), tn, 'Object from non-empty array literal: Object(["hello", 5])');
	lists_tests(Object(["hello", 5]), tn, 'Object(["hello", 5])');
	equals(T(Array("hello", 5)), tn, 'non-empty Array: Array("hello", 5)');
	lists_tests(Array("hello", 5), tn, 'Array("hello", 5)');
});

test('node lists', function(){
	var tn;
	equals(tn=T(document.childNodes), 'list', 'document.childNodes');
	lists_tests(document.childNodes, tn, 'document.childNodes');

	equals(tn=T($("#no-child-nodes")[0].childNodes), 'list.empty', '$("#no-child-nodes")[0].childNodes');
	lists_tests($("#no-child-nodes")[0].childNodes, tn, '$("#no-child-nodes")[0].childNodes');
});
/*
module('others');



test('node', function(){
	ok('node' in T, '$.TypeOf.node');
});

test('def', function(){
	ok('def' in T, '$.TypeOf.def');
});

test('undef', function(){
	ok('undef' in T, '$.TypeOf.undef');
});

test('fn', function(){
	ok('fn' in T, '$.TypeOf.fn');
});

test('inherited', function(){
	ok('inherited' in T, '$.TypeOf.inherited');
});

test('inheritedFn', function(){
	ok('inheritedFn' in T, '$.TypeOf.inheritedFn');
});

test('implementation', function(){
	ok('implementation' in T, '$.TypeOf.implementation');
	// ok(expr, 'description');
});

test('user-defined type tests', function(){
	ok('build_typeOf' in T, '$.TypeOf.build_typeOf');
});
*/

});

})(jQuery);
</script>

<script type="text/javascript">
$(function(){

var	builtin		= function(o)typeof(o),
	adorned		= $.TypeOf,
	unadorned	= $.TypeOf.unadorned,
	implementation	= $.TypeOf.implementation;

var	$table = $('table');

function tr( expr, label ){
	var $row = $('<tr/>');

	$row.	append($('<td>').text(label)).
		append($('<td>').text(adorned(expr))).
		append($('<td>').text(unadorned(expr))).
		append($('<td>').text(builtin(expr))).
		append($('<td>').text(implementation(expr)));

	$table.append($row);
}

tr(["hello"], '["hello"]');
tr([], '[]');
tr(true, 'true');
tr(new Date, 'new Date');
tr(function(){}, 'function(){}');
tr($(document), '$(document)');
tr($([]), '$([])');
tr(document.childNodes, 'document.childNodes');
(function(){
	tr(arguments, 'arguments');
})();
tr($("h1")[0], '$("h1")[0]');
tr(document, 'document');
tr(null, 'null');
tr(Math.PI, 'Math.PI');
tr(1/0, '1/0');
tr(0/0, '0/0');
tr({a:5}, '{a:5}');
tr({}, '{}');
tr(/xyz/, '/xyz/');
tr("Hello, World!", '"Hello, World!"');
tr("", '""');
tr("c", '"c"');
tr(undefined, 'undefined');
tr(window, 'window');

$table.find('tr').each(function(){
	function fold($s)$.trim($s.text()).toLowerCase();

	var $cells = $('td', this),
		$best=$cells.eq(1), $plain=$cells.eq(2), $builtin=$cells.eq(3), $raw=$cells.eq(4),
		best=fold($best), plain=fold($plain), builtin=fold($builtin), raw=fold($raw);

	if ( !plain ) return true;

	if ( best != builtin && best != raw ) {
		$best.css({backgroundColor:'lightgreen'});
	}

	if ( plain != builtin && plain != raw ) {
		$plain.css({backgroundColor:'lightgreen'});
	}


	if ( builtin=='object' && builtin!=plain && builtin!=raw ) {
		$builtin.css({backgroundColor: 'red'});
	}

	if ( /html|node/.exec(raw) ){
		$raw.css({backgroundColor: 'lightgreen'});
	}

	if ( raw=='window' && best!='window' ) {
		$raw.css({backgroundColor: 'red'});
	}
});

});
</script>
<style type="text/css">
#chart {
	margin: 1in;
}
</style>
</head>
<body>
	<h1>JavaScript Unit Tests: $.TypeOf</h1>

	<!-- required HTML -->
	<h2 id="banner"></h2>
	<h2 id="userAgent"></h2>
	<ol id="tests"></ol>
	<div id="main">
		<div id="no-child-nodes"></div>
		<!-- test content here -->
	</div>

	<table id="chart">
	<tr><td></td><td>$.TypeOf</td><td></td><td>typeof</td><td>raw</td></tr>
	</table>

</body>
</html>
