__section__
default
__description__
Template for generating the skinindexd template.  Uses an alternate
form of tags (<++> instead of [%%]) so it can write the standard tag
form into skinindexd.  Input:

* skins = arrayref of hashref of skin data (containing month,
	monthname, date, count, skin, rootdir)
* skin = name of parent skin

__title__

__page__
misc
__lang__
en_US
__name__
firehose_sections
__template__
[% fh = Slash.getObject("Slash::FireHose")
   sections = fh.getFireHoseSectionsMenu;
%]
[% cur_section_id = 0 %]
[% skip_edit = 0 %]
[% UNLESS (user.currentPage == "firehose" || user.currentPage == "index2" || user.currentPage == "console" || user.currentPage == "index");
	skip_edit = 1;
END;

IF  form.op == "view" || form.taskgen;
	skip_edit = 1;
END;
%]
[% cur_section = fh.determineCurrentSection() %]
[% IF cur_section && cur_section.fsid; cur_section_id = cur_section.fsid; END %]
[% default_section_id = constants.mainpage_skid %]
[% IF !user.is_anon && user.firehose_default_section; default_section_id = user.firehose_default_section; END %]
<ul id="firehose-sections">
	<script type="data">{ active_id:[% cur_section_id %], default_id:[% default_section_id %] }</script>
	[% FOREACH fh_section= sections %]
		[% hide = 0 %]
		[% IF fh_section.user_display; fh_section.display = fh_section.user_display; END %]
		[% IF fh_section.user_section_name; fh_section.section_name = fh_section.user_section_name; END %]
		[% IF fh_section.user_section_color; fh_section.user_section_color = fh_section.user_section_color; END %]
		[% is_active = 0 %]
		[% IF fh_section.fsid == cur_section_id; is_active = 1; END %]
		[% is_default = 0 %]
		[% IF cur_section_id == default_section_id; is_default = 1; END %]
		[% IF (fh_section.display == "no" && is_active == 0); hide=1; END %]
		[% link_loc = gskin.rootdir _ "/index2.pl?section=" _ fh_section.fsid %]
		[% IF fh_section.skid %]
			[% the_skin = Slash.db.getSkin(fh_section.skid) %]
			[% IF the_skin && the_skin.rootdir;
				link_loc = the_skin.rootdir;
			   END %]
		[% END %]
		<li class="[% IF is_active %]active[% ELSIF hide %]hide[% END %][% IF is_default %] default[% END %]" id="fhsection-[% fh_section.fsid %]">
			<a id="fhsectiontitle-[% fh_section.fsid %]" href="[% link_loc %]"[% IF !skip_edit %] onclick="return false;"[% END %]>[% fh_section.section_name %]</a>
			[% IF !skip_edit %] <a href="[% PROCESS nojslink %]" class="links-sections-edit">[e]</a>[% END %]
		<script type="data">[% fh.js_anon_dump(fh_section.data); %]</script>
		</li>
	[% END %]
</ul>
[% IF (user.currentPage == "index2" || user.currentPage == "firehose" || user.currentPage == "console") && form.op != "view" && !form.taskgen %]<script type="text/javascript">
$(function(){
$any('firehose-sections').mousedown(function( event ){
		// select a section on mousedown
		var $section = $(event.originalTarget || event.target).closest('li[id^=fhsection-]');
		if ( !$section.is('.active') ) {
			var section = $section.metadata();
			if ( section.id === 'unsaved' ) {
				firehose_set_options('setfhfilter', section.filter);
				firehose_set_options('view', section.viewname);
				section.color && firehose_set_options('color', section.color);
			} else {
				firehose_set_options('section', section.id);
			}
		}
		// allow other handlers to run
	}).
	click(function( event ){
		// edit only for a click in the edit button
		[% IF user.is_anon %]
			show_login_box();
			return false;
		[% END %]
		var $edit = $(event.originalTarget || event.target).closest('a.links-sections-edit');
		if ( $edit.length ) {
			var section = $edit.closest('li[id^=fhsection-]').metadata();
			if ( section.id === 'unsaved' ) {
				edit_the_unsaved_section();
			} else {
				getModalPrefs('firehoseview','Save Custom Section', 0, { id: section.id });
			}
		}
		return false;
	}).
	find('>li').
		each(function(){
			var $this = $(this);
			$this.metadata({type:'elem', name:'script'}); // force metadata initialization
			$this.children('script[type=data]').remove(); // and get rid of the (now useless) elem that delivered it to us
		});

$(document).bind('firehose-setting-section', function( e, fhsid ){
	var $section=$any('fhsection-' + fhsid), section=$section.metadata();
	firehose_highlight_section($section);
	$(document).
		trigger('firehose-setting-setfhfilter', section.filter).
		trigger('firehose-setting-view', section.viewname).
		trigger('firehose-setting-color', section.color);
	firehose_style_switch(fhsid);
});

});
</script>[% END %]
__seclev__
1000
__version__
$Id$
